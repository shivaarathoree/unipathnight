generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id              String    @id @default(uuid())
  firebaseUid     String    @unique
  email           String    @unique
  name            String?
  imageUrl        String?
  industry        String?
  bio             String?
  experience      Int?
  skills          String[]
  
  coverLetterUsageCount Int      @default(0)
  coverLetterLastReset  DateTime?
  resumeAIUsageCount    Int      @default(0)
  resumeAILastReset     DateTime?
  
  phone                 String?
  rollNumber            String?
  branch                String?
  department            String?
  departmentEmail       String?
  github                String?
  linkedin              String?
  collegeName           String?
  collegeLocation       String?
  graduationYear        String?
  seniorSecondaryBoard      String?
  seniorSecondaryPercentage String?
  seniorSecondaryYear       String?
  secondaryBoard            String?
  secondaryPercentage       String?
  secondaryYear             String?
  courses                   String[]
  programmingLanguages      String[]
  tools                     String[]
  frameworks                String[]
  webSkills                 String[]
  achievements              String[]
  experiences               Json?
  projects                  Json?
  responsibilities          Json?
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  industryInsight IndustryInsight? @relation(fields: [industry], references: [industry])
  assessments     Assessment[]
  resume          Resume?
  coverLetter     CoverLetter[]
}

model Assessment {
  id             String    @id @default(cuid())
  userId         String
  user           User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  score          Float
  questions      Json[]
  category       String
  improvementTip String?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  @@index([userId])
}

model Resume {
  id          String    @id @default(cuid())
  userId      String    @unique
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  content     String    @db.Text
  atsScore    Float?
  feedback    String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model CoverLetter {
  id              String    @id @default(cuid())
  userId          String
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  content         String    @db.Text
  jobDescription  String?   @db.Text
  companyName     String
  jobTitle        String
  status          String    @default("draft")
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  @@index([userId])
}

model IndustryInsight {
  id                 String    @id @default(cuid())
  industry           String    @unique
  users              User[]
  salaryRanges       Json[]
  growthRate         Float
  demandLevel        String
  topSkills          String[]
  marketOutlook      String
  keyTrends          String[]
  recommendedSkills  String[]
  lastUpdated        DateTime  @default(now())
  nextUpdate         DateTime

  @@index([industry])
}

model Interview {
  id          String   @id @default(cuid())
  role        String
  type        String
  level       String
  techstack   String[]
  questions   String[]
  userId      String
  status      String   @default("pending")
  coverImage  String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  feedback    InterviewFeedback[]

  @@map("interviews")
}

model InterviewFeedback {
  id                   String   @id @default(cuid())
  interviewId          String
  userId               String
  totalScore           Int
  categoryScores       Json
  strengths            String[]
  areasForImprovement  String[]
  finalAssessment      String
  responses            String[]
  audioRecordings      String[]
  createdAt            DateTime @default(now())

  interview   Interview @relation(fields: [interviewId], references: [id], onDelete: Cascade)

  @@map("interview_feedback")
}